# Finance Agent å®ç°æ¸…å•

> **æ–‡æ¡£ç›®çš„**ï¼šç³»ç»ŸåŒ–åœ°åˆ—å‡ºæ‰€æœ‰éœ€è¦å®ç°çš„åŠŸèƒ½ï¼Œç¡®ä¿ Python è¿ç§»è¿‡ç¨‹å®Œæ•´ä¸”æœ‰æ¡ç†  
> **ä½¿ç”¨æ–¹å¼**ï¼šæŒ‰ä¼˜å…ˆçº§é¡ºåºå®ç°ï¼Œå®Œæˆä¸€é¡¹å‹¾é€‰ä¸€é¡¹ï¼Œè¿½è¸ªè¿›åº¦

---

## ç›®å½•
- [ä¼˜å…ˆçº§è¯´æ˜](#ä¼˜å…ˆçº§è¯´æ˜)
- [Phase 1: é¡¹ç›®åˆå§‹åŒ–](#phase-1-é¡¹ç›®åˆå§‹åŒ–)
- [Phase 2: æ ¸å¿ƒæ¶æ„ï¼ˆP0ï¼‰](#phase-2-æ ¸å¿ƒæ¶æ„p0)
- [Phase 3: æ’ä»¶ç³»ç»Ÿï¼ˆP1ï¼‰](#phase-3-æ’ä»¶ç³»ç»Ÿp1)
- [Phase 4: æ•°æ®åº“å±‚ï¼ˆP1ï¼‰](#phase-4-æ•°æ®åº“å±‚p1)
- [Phase 5: ä¸šåŠ¡åŠŸèƒ½ï¼ˆP2ï¼‰](#phase-5-ä¸šåŠ¡åŠŸèƒ½p2)
- [Phase 6: å¢å¼ºåŠŸèƒ½ï¼ˆP2ï¼‰](#phase-6-å¢å¼ºåŠŸèƒ½p2)
- [Phase 7: æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆP3ï¼‰](#phase-7-æµ‹è¯•ä¸ä¼˜åŒ–p3)
- [Phase 8: éƒ¨ç½²å‡†å¤‡ï¼ˆP3ï¼‰](#phase-8-éƒ¨ç½²å‡†å¤‡p3)

---

## ä¼˜å…ˆçº§è¯´æ˜

| ä¼˜å…ˆçº§ | è¯´æ˜ | å¼€å‘é˜¶æ®µ |
|--------|------|----------|
| **P0ï¼ˆå¿…éœ€ï¼‰** | ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½ï¼Œæ²¡æœ‰è¿™äº›åŠŸèƒ½ç³»ç»Ÿæ— æ³•è¿è¡Œ | ç¬¬ 1 å‘¨ |
| **P1ï¼ˆæ ¸å¿ƒï¼‰** | æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ï¼Œæä¾›åŸºæœ¬å¯ç”¨æ€§ | ç¬¬ 2-3 å‘¨ |
| **P2ï¼ˆå¢å¼ºï¼‰** | å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œæå‡ç³»ç»Ÿå®Œæ•´åº¦ | ç¬¬ 4-5 å‘¨ |
| **P3ï¼ˆä¼˜åŒ–ï¼‰** | æ€§èƒ½ä¼˜åŒ–å’Œè¾¹ç¼˜åœºæ™¯å¤„ç† | ç¬¬ 6 å‘¨+ |

---

## Phase 1: é¡¹ç›®åˆå§‹åŒ–

### 1.1 ç¯å¢ƒé…ç½® (P0)
- [ ] åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š`python -m venv venv`
- [ ] åˆå§‹åŒ– `requirements.txt`ï¼š
  - [ ] `fastapi>=0.104.0`
  - [ ] `uvicorn[standard]>=0.24.0`
  - [ ] `anthropic>=0.7.0`
  - [ ] `sqlalchemy>=2.0.0`
  - [ ] `aiosqlite>=0.19.0`
  - [ ] `websockets>=12.0`
  - [ ] `python-dotenv>=1.0.0`
  - [ ] `watchdog>=3.0.0`
  - [ ] `pydantic>=2.0.0`
- [ ] åˆ›å»º `.env` æ–‡ä»¶ï¼š
  - [ ] `ANTHROPIC_API_KEY=your_key_here`
  - [ ] `DATABASE_PATH=./data/finance.db`
  - [ ] `LOG_LEVEL=INFO`

### 1.2 é¡¹ç›®ç»“æ„ (P0)
```
finance-agent/
â”œâ”€â”€ ccsdk/                  # SDK æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ session.py
â”‚   â”œâ”€â”€ websocket_handler.py
â”‚   â”œâ”€â”€ listeners_manager.py
â”‚   â”œâ”€â”€ actions_manager.py
â”‚   â””â”€â”€ ui_state_manager.py
â”œâ”€â”€ database/               # æ•°æ®åº“å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database_manager.py
â”‚   â”œâ”€â”€ schema.sql
â”‚   â””â”€â”€ models.py
â”œâ”€â”€ agent/                  # ä¸šåŠ¡é€»è¾‘
â”‚   â””â”€â”€ custom_scripts/
â”‚       â”œâ”€â”€ listeners/
â”‚       â”œâ”€â”€ actions/
â”‚       â””â”€â”€ types.py
â”œâ”€â”€ server/                 # æœåŠ¡ç«¯
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ server.py
â”‚   â””â”€â”€ endpoints.py
â”œâ”€â”€ client/                 # å‰ç«¯ï¼ˆReactï¼‰
â”‚   â””â”€â”€ (æš‚æ—¶è·³è¿‡ï¼Œå…ˆå®Œæˆåç«¯)
â”œâ”€â”€ tests/                  # æµ‹è¯•
â”‚   â”œâ”€â”€ test_session.py
â”‚   â””â”€â”€ test_database.py
â”œâ”€â”€ .env
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

- [ ] åˆ›å»ºä¸Šè¿°ç›®å½•ç»“æ„
- [ ] åˆå§‹åŒ–æ‰€æœ‰ `__init__.py` æ–‡ä»¶
- [ ] åˆ›å»º `README.md` åŒ…å«å¯åŠ¨è¯´æ˜

---

## Phase 2: æ ¸å¿ƒæ¶æ„ï¼ˆP0ï¼‰

> âš ï¸ **é‡è¦æç¤º**ï¼šè™½ç„¶ Session ç±»æ’åœ¨å‰é¢ï¼Œä½†å»ºè®®å…ˆå®Œæˆ **Phase 2.0ï¼ˆæ•°æ®åº“è®¾è®¡è¯„å®¡ï¼‰**ï¼Œç¡®ä¿æ•°æ®æ¨¡å‹æ­£ç¡®åå†å¼€å§‹ç¼–ç ã€‚

### 2.0 æ•°æ®åº“è®¾è®¡è¯„å®¡ï¼ˆP0 - å‰ç½®ä»»åŠ¡ï¼‰
**å‚è€ƒæ–‡æ¡£**ï¼š`DATABASE_SCHEMA.md`

- [ ] é˜…è¯» `DATABASE_SCHEMA.md`ï¼Œç†è§£è¡¨ç»“æ„è®¾è®¡
- [ ] ç¡®è®¤ Finance Agent çš„æ ¸å¿ƒä¸šåŠ¡å®ä½“ï¼š
  - [ ] **Transactionï¼ˆäº¤æ˜“ï¼‰**ï¼šid, amount, date, category, merchant, account
  - [ ] **Accountï¼ˆè´¦æˆ·ï¼‰**ï¼šæ˜¯å¦éœ€è¦å•ç‹¬å»ºè¡¨ï¼Ÿ
  - [ ] **Categoryï¼ˆåˆ†ç±»ï¼‰**ï¼šå›ºå®šæšä¸¾ vs åŠ¨æ€è¡¨ï¼Ÿ
  - [ ] **Budgetï¼ˆé¢„ç®—ï¼‰**ï¼šæ˜¯å¦çº³å…¥ MVP èŒƒå›´ï¼Ÿ
- [ ] ç»˜åˆ¶ ER å›¾ï¼ˆå®ä½“å…³ç³»å›¾ï¼‰
- [ ] è¯„å®¡ç´¢å¼•è®¾è®¡ï¼ˆæŸ¥è¯¢æ€§èƒ½ï¼‰
- [ ] ç¡®è®¤è¿ç§»ç­–ç•¥ï¼ˆSQLAlchemy Alembic vs æ‰‹åŠ¨ SQLï¼‰
- [ ] **è¯„å®¡é€šè¿‡åæ‰ç»§ç»­ Phase 2.1**

**è¾“å‡ºäº§ç‰©**ï¼š
- [ ] `database/ER_DIAGRAM.md`ï¼ˆER å›¾ï¼‰
- [ ] `database/schema.sql`ï¼ˆåˆå§‹ç‰ˆæœ¬ï¼‰
- [ ] `database/models.py`ï¼ˆSQLAlchemy æ¨¡å‹å®šä¹‰ï¼‰

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] æ‰‹åŠ¨æ‰§è¡Œ `schema.sql` éªŒè¯è¯­æ³•
- [ ] ä½¿ç”¨ SQLAlchemy åˆ›å»ºè¡¨ï¼Œæ£€æŸ¥å¤–é”®çº¦æŸ

---

### 2.1 Session ç±»å®ç° (P0)
**å‚è€ƒæ–‡æ¡£**ï¼š`SESSION_FLOW.md`

**æ–‡ä»¶**ï¼š`ccsdk/session.py`

- [x] å®šä¹‰ `Session` ç±»åŸºç¡€ç»“æ„
  - [x] `__init__(self, session_id: str, db)`
  - [x] `id: str` å±æ€§
  - [x] `_query_lock: asyncio.Lock` å¹¶å‘æ§åˆ¶é”
  - [x] `_subscribers: Set[WSClient]` è®¢é˜…è€…é›†åˆ
  - [x] `_sdk_session_id: Optional[str]` å¤šè½®å¯¹è¯ ID

- [x] å®ç° `add_user_message()` æ–¹æ³•
  - [x] ä½¿ç”¨ `async with self._query_lock` æ§åˆ¶å¹¶å‘
  - [x] è°ƒç”¨ `AIClient.query_stream()` è·å–æµå¼å“åº”
  - [x] æ•è· `sdk_session_id` ç”¨äºå¤šè½®å¯¹è¯
  - [x] é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
  - [x] **P1 ä¿®å¤**: æ­£ç¡®æ›´æ–° `_is_querying` çŠ¶æ€

- [x] å®ç° `subscribe()` æ–¹æ³•
  - [x] æ·»åŠ å®¢æˆ·ç«¯åˆ° `_subscribers`
  - [x] å‘é€ä¼šè¯åˆå§‹åŒ–æ¶ˆæ¯

- [x] å®ç° `unsubscribe()` æ–¹æ³•
  - [x] ä» `_subscribers` ç§»é™¤å®¢æˆ·ç«¯

- [x] å®ç° `_broadcast_to_subscribers()` æ–¹æ³•
  - [x] å°†æ¶ˆæ¯åºåˆ—åŒ–ä¸º JSON
  - [x] éå†æ‰€æœ‰è®¢é˜…è€…å‘é€æ¶ˆæ¯
  - [x] å¤„ç†å‘é€å¤±è´¥çš„å®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨ç§»é™¤ï¼‰

- [x] å®ç° `cleanup()` æ–¹æ³•
  - [x] æ¸…ç©ºè®¢é˜…è€…
  - [x] é‡Šæ”¾èµ„æº

- [x] å®ç° `end_conversation()` æ–¹æ³•
  - [x] **P1 ä¿®å¤**: é‡ç½®æ‰€æœ‰çŠ¶æ€ï¼ˆsdk_session_id + _is_queryingï¼‰

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [x] ç¼–å†™å•å…ƒæµ‹è¯• `scripts/test_session_fixes.py`
- [x] æµ‹è¯•å¹¶å‘æ¶ˆæ¯å¤„ç†ï¼ˆä¸¤ä¸ªæ¶ˆæ¯æŒ‰é¡ºåºæ‰§è¡Œï¼‰
- [x] æµ‹è¯•å¤šè½®å¯¹è¯ï¼ˆ`sdk_session_id` ä¿æŒä¸€è‡´ï¼‰
- [x] æµ‹è¯•è®¢é˜…è€…å¹¿æ’­ï¼ˆæ‰€æœ‰å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯ï¼‰
- [x] æµ‹è¯• P0/P1 ä¿®å¤æ•ˆæœ

**å®ç°çŠ¶æ€**: âœ… **å·²å®Œæˆå¹¶ä¿®å¤** (2024-11-28)
- æ–‡ä»¶: `ccsdk/session.py` (347 è¡Œ)
- æµ‹è¯•: `scripts/test_session_fixes.py` (215 è¡Œ)
- æ–‡æ¡£: `SESSION_FIXES.md` (ä¿®å¤æ€»ç»“)
- P0 ä¿®å¤: AIClient æ¶ˆæ¯æ ¼å¼ï¼ˆæ”¯æŒ tool_useï¼‰
- P1 ä¿®å¤: çŠ¶æ€ç®¡ç†ï¼ˆ_is_querying + end_conversationï¼‰

---

### 2.2 AIClient ç±»å®ç° (P0)
**æ–‡ä»¶**ï¼š`ccsdk/ai_client.py`

- [x] å®šä¹‰ `AIClient` ç±»
  - [x] åˆå§‹åŒ– Claude Agent SDK å®¢æˆ·ç«¯
  - [x] é…ç½® API å¯†é’¥ï¼ˆä»ç¯å¢ƒå˜é‡è¯»å–ï¼‰

- [x] å®ç° `query_stream()` å¼‚æ­¥ç”Ÿæˆå™¨
  - [x] æ”¯æŒ `resume` å‚æ•°ï¼ˆå¤šè½®å¯¹è¯ï¼‰
  - [x] æµå¼è¿”å› SDK æ¶ˆæ¯
  - [x] å¤„ç† `assistant`ã€`tool_use`ã€`tool_result`ã€`result`ã€`system` æ¶ˆæ¯ç±»å‹
  - [x] **P0 ä¿®å¤**: ä¿ç•™å®Œæ•´çš„ content å—ç»“æ„ï¼ˆæ”¯æŒ tool_useï¼‰

- [x] å®ç° `_convert_sdk_message()` æ–¹æ³•
  - [x] è½¬æ¢ AssistantMessageï¼ˆä¿ç•™ textã€tool_useã€tool_result å—ï¼‰
  - [x] è½¬æ¢ SystemMessage
  - [x] è½¬æ¢ ResultMessage
  - [x] è½¬æ¢ UserMessage

- [x] å®ç°é”™è¯¯å¤„ç†
  - [x] é”™è¯¯æ—¥å¿—è®°å½•
  - [ ] API è¶…æ—¶é‡è¯•ï¼ˆå¾…å®Œå–„ï¼‰
  - [ ] é€Ÿç‡é™åˆ¶å¤„ç†ï¼ˆå¾…å®Œå–„ï¼‰

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [x] æµ‹è¯•å•è½®å¯¹è¯
- [x] æµ‹è¯•å¤šè½®å¯¹è¯ï¼ˆä½¿ç”¨ `resume`ï¼‰
- [x] æµ‹è¯•æµå¼å“åº”è§£æ
- [x] æµ‹è¯•æ¶ˆæ¯ç±»å‹è½¬æ¢ï¼ˆP0 ä¿®å¤éªŒè¯ï¼‰

**å®ç°çŠ¶æ€**: âœ… **å·²å®Œæˆå¹¶ä¿®å¤** (2024-11-28)
- æ–‡ä»¶: `ccsdk/ai_client.py` (272 è¡Œ)
- P0 ä¿®å¤: æ¶ˆæ¯æ ¼å¼è½¬æ¢ï¼ˆå®Œæ•´ä¿ç•™ tool_use ç­‰å—ï¼‰
- é›†æˆæµ‹è¯•: é€šè¿‡ `test_session_fixes.py` éªŒè¯

---

### 2.3 WebSocketHandler ç±»å®ç° (P0)
**å‚è€ƒæ–‡æ¡£**ï¼š`WEBSOCKET_HANDLER.md`

**æ–‡ä»¶**ï¼š`ccsdk/websocket_handler.py`

- [x] å®šä¹‰ `WebSocketHandler` ç±»
  - [x] `sessions: Dict[str, Session]` ä¼šè¯ç®¡ç†å­—å…¸
  - [x] `clients: Dict[str, WSClient]` å®¢æˆ·ç«¯ç®¡ç†å­—å…¸

- [x] å®ç° `start()` / `stop()` æ–¹æ³•
  - [x] å¯åŠ¨æŠ¥å‘Šæ•°æ®ç›‘æ§ä»»åŠ¡
  - [x] æ¸…ç†æ‰€æœ‰èµ„æº

- [x] å®ç° `on_open()` æ–¹æ³•
  - [x] æ¥å— WebSocket è¿æ¥
  - [x] å‘é€è¿æ¥ç¡®è®¤æ¶ˆæ¯
  - [x] å‘é€åˆå§‹æŠ¥å‘Šåˆ—è¡¨

- [x] å®ç° `on_message()` æ–¹æ³•
  - [x] è§£æ JSON æ¶ˆæ¯
  - [x] å¤„ç† `chat` æ¶ˆæ¯ï¼ˆèŠå¤©å¯¹è¯ï¼‰
  - [x] å¤„ç† `subscribe` æ¶ˆæ¯ï¼ˆè®¢é˜… Sessionï¼‰
  - [x] å¤„ç† `unsubscribe` æ¶ˆæ¯ï¼ˆå–æ¶ˆè®¢é˜…ï¼‰
  - [x] å¤„ç† `request_reports` æ¶ˆæ¯ï¼ˆè¯·æ±‚æŠ¥å‘Šåˆ—è¡¨ï¼‰
  - [x] é”™è¯¯å¤„ç†ï¼ˆæ— æ•ˆæ¶ˆæ¯æ ¼å¼ï¼‰

- [x] å®ç° `on_close()` æ–¹æ³•
  - [x] ä»ä¼šè¯ä¸­å–æ¶ˆè®¢é˜…
  - [x] æ¸…ç†æ— è®¢é˜…è€…çš„ä¼šè¯

- [x] å®ç°æ•°æ®å¹¿æ’­æ–¹æ³•
  - [x] `_broadcast_reports_update()` - å¹¿æ’­æŠ¥å‘Šåˆ—è¡¨
  - [x] `_broadcast_ui_state_update()` - å¹¿æ’­ UI çŠ¶æ€æ›´æ–°

- [x] å®ç°è‡ªåŠ¨æ¨é€
  - [x] `_init_report_watcher()` - æ¯ 5 ç§’è‡ªåŠ¨æ¨é€æŠ¥å‘Šåˆ—è¡¨

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [x] ç¼–å†™å®Œæ•´æµ‹è¯• `tests/test_websocket_handler.py` (384 è¡Œ)
- [x] æµ‹è¯• WebSocket è¿æ¥å»ºç«‹
- [x] æµ‹è¯•ä¼šè¯åˆ›å»ºå’Œè®¢é˜…
- [x] æµ‹è¯•æ¶ˆæ¯å¹¿æ’­
- [x] æµ‹è¯•æ•°æ®è‡ªåŠ¨æ¨é€ (5 ç§’è½®è¯¢)
- [x] æµ‹è¯•å¹¶å‘èŠå¤©
- [x] æµ‹è¯•é”™è¯¯å¤„ç†

**å®ç°çŠ¶æ€**: âœ… **å·²å®Œæˆ** (2024-11-27)
- æ–‡ä»¶: `ccsdk/websocket_handler.py` (374 è¡Œ)
- æµ‹è¯•: `scripts/test_websocket_handler.py` (384 è¡Œ)
- æ–‡æ¡£: `WEBSOCKET_HANDLER.md` (425 è¡Œ)
- å¯¹åº” TS: `websocket-handler.ts` (666 è¡Œ)

---

## Phase 3: æ’ä»¶ç³»ç»Ÿï¼ˆP1ï¼‰

### 3.1 ListenersManager å®ç° (P1)
**å‚è€ƒæ–‡æ¡£**ï¼š`PLUGIN_LOADING.md`, `LISTENER_TEMPLATE.md`

**æ–‡ä»¶**ï¼š`ccsdk/listeners_manager.py`

- [ ] å®šä¹‰ `ListenersManager` ç±»
  - [ ] `_listeners: Dict[str, ListenerModule]` ç›‘å¬å™¨å­˜å‚¨
  - [ ] `_listeners_dir: str` ç›‘å¬å™¨è„šæœ¬ç›®å½•

- [ ] å®ç° `load_all_listeners()` æ–¹æ³•
  - [ ] æ‰«æ `agent/custom_scripts/listeners/` ç›®å½•
  - [ ] åŠ¨æ€å¯¼å…¥æ‰€æœ‰ `.py` æ–‡ä»¶ï¼ˆè·³è¿‡ `_` å’Œ `.` å¼€å¤´ï¼‰
  - [ ] éªŒè¯ `config` å’Œ `handler` å­˜åœ¨
  - [ ] åªåŠ è½½ `enabled=True` çš„ç›‘å¬å™¨

- [ ] å®ç° `_load_listener()` æ–¹æ³•
  - [ ] ä½¿ç”¨ `importlib.import_module()` åŠ¨æ€åŠ è½½
  - [ ] æ¸…é™¤ `sys.modules` ç¼“å­˜å®ç°çƒ­é‡è½½
  - [ ] é”™è¯¯å¤„ç†ï¼ˆè¯­æ³•é”™è¯¯ã€ç¼ºå°‘å¿…éœ€å­—æ®µï¼‰

- [ ] å®ç° `check_event()` æ–¹æ³•
  - [ ] æ ¹æ® `event` ç±»å‹åŒ¹é…ç›‘å¬å™¨
  - [ ] æ‰§è¡Œæ‰€æœ‰åŒ¹é…çš„ `handler`
  - [ ] è®°å½•æ‰§è¡Œæ—¶é—´å’Œç»“æœ
  - [ ] å†™å…¥ JSONL æ—¥å¿—æ–‡ä»¶

- [ ] å®ç° `_create_context()` æ–¹æ³•
  - [ ] åˆ›å»º `ListenerContext` å¯¹è±¡
  - [ ] æ³¨å…¥ `notify()`, `call_agent()`, `ui_state` æ–¹æ³•
  - [ ] æ³¨å…¥äº¤æ˜“æ“ä½œæ–¹æ³•ï¼ˆå¯¹åº” Email Agent çš„é‚®ä»¶æ“ä½œï¼‰

- [ ] å®ç° `watch_listeners()` æ–¹æ³•
  - [ ] ä½¿ç”¨ `watchdog` ç›‘å¬æ–‡ä»¶å˜åŒ–
  - [ ] æ–‡ä»¶ä¿®æ”¹æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½
  - [ ] è§¦å‘å›è°ƒé€šçŸ¥å‰ç«¯

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] ç¼–å†™ç¤ºä¾‹ç›‘å¬å™¨ `test_listener.py`
- [ ] æµ‹è¯•ç›‘å¬å™¨åŠ è½½ï¼ˆ`load_all_listeners()`ï¼‰
- [ ] æµ‹è¯•äº‹ä»¶è§¦å‘ï¼ˆ`check_event()`ï¼‰
- [ ] æµ‹è¯•çƒ­é‡è½½ï¼ˆä¿®æ”¹æ–‡ä»¶åè‡ªåŠ¨åŠ è½½ï¼‰
- [ ] æµ‹è¯•æ—¥å¿—å†™å…¥ï¼ˆJSONL æ ¼å¼ï¼‰

---

### 3.2 ActionsManager å®ç° (P1)
**å‚è€ƒæ–‡æ¡£**ï¼š`ACTION_TEMPLATE.md`

**æ–‡ä»¶**ï¼š`ccsdk/actions_manager.py`

- [ ] å®šä¹‰ `ActionsManager` ç±»
  - [ ] `_templates: Dict[str, ActionModule]` åŠ¨ä½œæ¨¡æ¿å­˜å‚¨
  - [ ] `_instances: Dict[str, ActionInstance]` åŠ¨ä½œå®ä¾‹å­˜å‚¨

- [ ] å®ç° `load_all_templates()` æ–¹æ³•
  - [ ] æ‰«æ `agent/custom_scripts/actions/` ç›®å½•
  - [ ] åŠ¨æ€å¯¼å…¥æ‰€æœ‰ `.py` æ–‡ä»¶
  - [ ] éªŒè¯ `config` å’Œ `handler` å­˜åœ¨

- [ ] å®ç° `register_instance()` æ–¹æ³•
  - [ ] ç”± Agent åˆ›å»ºåŠ¨ä½œå®ä¾‹æ—¶è°ƒç”¨
  - [ ] å­˜å‚¨å®ä¾‹ä¿¡æ¯ï¼ˆ`instanceId`, `templateId`, `params`ï¼‰

- [ ] å®ç° `execute_action()` æ–¹æ³•
  - [ ] æ ¹æ® `instanceId` æŸ¥æ‰¾å®ä¾‹
  - [ ] è·å–å¯¹åº”çš„æ¨¡æ¿ `handler`
  - [ ] åˆ›å»º `ActionContext` å¯¹è±¡
  - [ ] æ‰§è¡Œ `handler(params, context)`
  - [ ] è®°å½•æ‰§è¡Œç»“æœå’Œæ—¶é—´
  - [ ] å†™å…¥ JSONL æ—¥å¿—æ–‡ä»¶

- [ ] å®ç° `_create_context()` æ–¹æ³•
  - [ ] åˆ›å»º `ActionContext` å¯¹è±¡
  - [ ] æ³¨å…¥ `log()`, `notify()`, `call_agent()` æ–¹æ³•
  - [ ] æ³¨å…¥ `ui_state`, `transactions` æ“ä½œæ–¹æ³•

- [ ] å®ç° `watch_templates()` æ–¹æ³•
  - [ ] ä½¿ç”¨ `watchdog` ç›‘å¬æ–‡ä»¶å˜åŒ–

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] ç¼–å†™ç¤ºä¾‹åŠ¨ä½œ `test_action.py`
- [ ] æµ‹è¯•åŠ¨ä½œæ¨¡æ¿åŠ è½½
- [ ] æµ‹è¯•åŠ¨ä½œå®ä¾‹æ³¨å†Œ
- [ ] æµ‹è¯•åŠ¨ä½œæ‰§è¡Œï¼ˆ`execute_action()`ï¼‰
- [ ] æµ‹è¯•å‚æ•°éªŒè¯ï¼ˆJSON Schemaï¼‰

---

### 3.3 UIStateManager å®ç° (P1)
**æ–‡ä»¶**ï¼š`ccsdk/ui_state_manager.py`

- [ ] å®šä¹‰ `UIStateManager` ç±»
  - [ ] `_db_manager: DatabaseManager` æ•°æ®åº“ä¾èµ–

- [ ] å®ç° `get_state()` æ–¹æ³•
  - [ ] è°ƒç”¨ `DatabaseManager.get_ui_state()`
  - [ ] è¿”å›çŠ¶æ€æ•°æ®ï¼ˆè§£æ JSONï¼‰

- [ ] å®ç° `set_state()` æ–¹æ³•
  - [ ] åºåˆ—åŒ–æ•°æ®ä¸º JSON
  - [ ] è°ƒç”¨ `DatabaseManager.set_ui_state()`
  - [ ] å¹¿æ’­çŠ¶æ€æ›´æ–°ï¼ˆé€šè¿‡ WebSocketï¼‰

- [ ] å®ç° `load_all_templates()` æ–¹æ³•
  - [ ] æ‰«æ `agent/custom_scripts/ui_states/` ç›®å½•
  - [ ] åŠ è½½æ‰€æœ‰ UI çŠ¶æ€æ¨¡æ¿

- [ ] å®ç° `watch_templates()` æ–¹æ³•
  - [ ] ç›‘å¬æ¨¡æ¿æ–‡ä»¶å˜åŒ–

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] æµ‹è¯•çŠ¶æ€è¯»å†™
- [ ] æµ‹è¯•çŠ¶æ€å¹¿æ’­

---

## Phase 4: æ•°æ®åº“å±‚ï¼ˆP1ï¼‰

> ğŸ“Œ **æ³¨æ„**ï¼šæ­¤é˜¶æ®µçš„æ¨¡å‹å®šä¹‰åº”è¯¥æ˜¯ Phase 2.0 è®¾è®¡çš„**å®ç°å’Œå®Œå–„**ï¼Œè€Œéé¦–æ¬¡è®¾è®¡ã€‚

### 4.1 SQLAlchemy æ¨¡å‹å®Œå–„ (P1)
**å‚è€ƒæ–‡æ¡£**ï¼š`DATABASE_SCHEMA.md`

**æ–‡ä»¶**ï¼š`database/models.py`

> âš ï¸ å‰ç½®æ¡ä»¶ï¼šPhase 2.0 çš„æ•°æ®åº“è®¾è®¡å·²è¯„å®¡é€šè¿‡

- [ ] å®šä¹‰ `Base` åŸºç±»ï¼ˆä½¿ç”¨ `declarative_base()`ï¼‰

- [ ] å®šä¹‰ `Transaction` æ¨¡å‹ï¼ˆå¯¹åº” Email Agent çš„ `emails` è¡¨ï¼‰
  - [ ] `id: int` (ä¸»é”®)
  - [ ] `transaction_id: str` (å”¯ä¸€ç´¢å¼•)
  - [ ] `date: datetime` (äº¤æ˜“æ—¥æœŸ)
  - [ ] `amount: float` (é‡‘é¢)
  - [ ] `category: str` (ç±»åˆ«ï¼Œå¯é€‰)
  - [ ] `description: str` (æè¿°ï¼Œå¯é€‰)
  - [ ] `merchant: str` (å•†å®¶åç§°ï¼Œå¯é€‰)
  - [ ] `account: str` (è´¦æˆ·)
  - [ ] `is_expense: bool` (æ˜¯å¦ä¸ºæ”¯å‡º)
  - [ ] `is_recurring: bool` (æ˜¯å¦ä¸ºå®šæœŸäº¤æ˜“)
  - [ ] `tags: str` (JSON å­—ç¬¦ä¸²ï¼Œæ ‡ç­¾æ•°ç»„)
  - [ ] `created_at: datetime`
  - [ ] `updated_at: datetime`

- [ ] å®šä¹‰ `UIState` æ¨¡å‹
  - [ ] `id: int`
  - [ ] `state_id: str` (å”¯ä¸€ç´¢å¼•)
  - [ ] `data_json: str` (JSON æ•°æ®)
  - [ ] `created_at: datetime`
  - [ ] `updated_at: datetime`

- [ ] å®šä¹‰ `ComponentInstance` æ¨¡å‹
  - [ ] `id: int`
  - [ ] `instance_id: str` (å”¯ä¸€ç´¢å¼•)
  - [ ] `component_id: str`
  - [ ] `state_id: str`
  - [ ] `session_id: str` (å¯é€‰)
  - [ ] `created_at: datetime`

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] æµ‹è¯•æ¨¡å‹åˆ›å»ºï¼ˆ`Base.metadata.create_all()`ï¼‰
- [ ] æµ‹è¯•å­—æ®µç±»å‹å’Œçº¦æŸ

---

### 4.2 DatabaseManager å®ç° (P1)
**æ–‡ä»¶**ï¼š`database/database_manager.py`

- [ ] å®šä¹‰ `DatabaseManager` å•ä¾‹ç±»
  - [ ] `_instance: Optional[DatabaseManager]` å•ä¾‹å®ä¾‹
  - [ ] `_engine: AsyncEngine` å¼‚æ­¥å¼•æ“
  - [ ] `_session_factory: sessionmaker` ä¼šè¯å·¥å‚

- [ ] å®ç° `__new__()` å•ä¾‹æ¨¡å¼
  - [ ] ç¡®ä¿åªåˆ›å»ºä¸€ä¸ªå®ä¾‹

- [ ] å®ç° `get_instance()` ç±»æ–¹æ³•
  - [ ] è¿”å›å•ä¾‹å®ä¾‹

- [ ] å®ç° `initialize()` æ–¹æ³•
  - [ ] åˆ›å»º `AsyncEngine`ï¼ˆ`sqlite+aiosqlite`ï¼‰
  - [ ] æ‰§è¡Œ `schema.sql` åˆå§‹åŒ–è¡¨ç»“æ„
  - [ ] åˆ›å»ºç´¢å¼•

- [ ] å®ç° `upsert_transaction()` æ–¹æ³•
  - [ ] æ’å…¥æˆ–æ›´æ–°äº¤æ˜“è®°å½•
  - [ ] å¤„ç†æ ‡ç­¾æ•°ç»„ï¼ˆJSON åºåˆ—åŒ–ï¼‰
  - [ ] è¿”å›äº¤æ˜“ ID

- [ ] å®ç° `search_transactions()` æ–¹æ³•
  - [ ] æ”¯æŒå¤šæ¡ä»¶æœç´¢ï¼ˆæ—¥æœŸèŒƒå›´ã€é‡‘é¢èŒƒå›´ã€ç±»åˆ«ã€å•†å®¶ï¼‰
  - [ ] æ”¯æŒå…¨æ–‡æœç´¢ï¼ˆä½¿ç”¨ FTS5ï¼Œå¯é€‰ï¼‰
  - [ ] åˆ†é¡µï¼ˆ`limit`, `offset`ï¼‰

- [ ] å®ç° `get_transaction_by_id()` æ–¹æ³•
  - [ ] æ ¹æ® `transaction_id` æŸ¥è¯¢

- [ ] å®ç° UI çŠ¶æ€æ“ä½œæ–¹æ³•
  - [ ] `get_ui_state(state_id: str)`
  - [ ] `set_ui_state(state_id: str, data: Any)`
  - [ ] `list_ui_states()`
  - [ ] `delete_ui_state(state_id: str)`

- [ ] å®ç° `register_component_instance()` æ–¹æ³•
  - [ ] æ³¨å†Œç»„ä»¶å®ä¾‹åˆ°æ•°æ®åº“

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] ç¼–å†™æµ‹è¯• `tests/test_database.py`
- [ ] æµ‹è¯•å•ä¾‹æ¨¡å¼ï¼ˆå¤šæ¬¡è°ƒç”¨ `get_instance()` è¿”å›åŒä¸€å®ä¾‹ï¼‰
- [ ] æµ‹è¯•äº¤æ˜“æ’å…¥å’ŒæŸ¥è¯¢
- [ ] æµ‹è¯•æœç´¢åŠŸèƒ½
- [ ] æµ‹è¯• UI çŠ¶æ€è¯»å†™

---

### 4.3 æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ (P1)
**æ–‡ä»¶**ï¼š`database/schema.sql`

- [ ] å®šä¹‰ `transactions` è¡¨
  - [ ] æ‰€æœ‰å­—æ®µå®šä¹‰
  - [ ] ç´¢å¼•ï¼ˆ`transaction_id`, `date`, `category`, `account`ï¼‰
  - [ ] è§¦å‘å™¨ï¼ˆè‡ªåŠ¨æ›´æ–° `updated_at`ï¼‰

- [ ] å®šä¹‰ `ui_states` è¡¨
  - [ ] å­—æ®µå’Œç´¢å¼•

- [ ] å®šä¹‰ `component_instances` è¡¨
  - [ ] å­—æ®µå’Œç´¢å¼•

- [ ] ï¼ˆå¯é€‰ï¼‰å®šä¹‰ FTS5 è™šæ‹Ÿè¡¨
  - [ ] ç”¨äºå…¨æ–‡æœç´¢äº¤æ˜“æè¿°å’Œå•†å®¶åç§°

**æ‰§è¡Œæ£€æŸ¥**ï¼š
- [ ] æ‰‹åŠ¨æ‰§è¡Œ SQL æ–‡ä»¶éªŒè¯è¯­æ³•
- [ ] é€šè¿‡ `DatabaseManager.initialize()` è‡ªåŠ¨æ‰§è¡Œ

---

## Phase 5: ä¸šåŠ¡åŠŸèƒ½ï¼ˆP2ï¼‰

### 5.1 æœåŠ¡ç«¯å®ç° (P2)
**æ–‡ä»¶**ï¼š`server/server.py`

- [ ] åˆ›å»º FastAPI åº”ç”¨
  - [ ] `app = FastAPI()`
  - [ ] é…ç½® CORS ä¸­é—´ä»¶

- [ ] å®ç° WebSocket ç«¯ç‚¹ `/ws`
  - [ ] æ¥å—è¿æ¥
  - [ ] è°ƒç”¨ `WebSocketHandler.on_connect()`
  - [ ] æ¥æ”¶æ¶ˆæ¯å¹¶è°ƒç”¨ `WebSocketHandler.on_message()`
  - [ ] æ–­å¼€è¿æ¥æ—¶è°ƒç”¨ `WebSocketHandler.on_disconnect()`

- [ ] å®ç° REST API ç«¯ç‚¹
  - [ ] `GET /api/transactions` - è·å–äº¤æ˜“åˆ—è¡¨
  - [ ] `POST /api/transactions/search` - æœç´¢äº¤æ˜“
  - [ ] `GET /api/transaction/{id}` - è·å–äº¤æ˜“è¯¦æƒ…
  - [ ] `GET /api/listeners` - è·å–æ‰€æœ‰ç›‘å¬å™¨
  - [ ] `GET /api/listener/{id}/logs` - è·å–ç›‘å¬å™¨æ—¥å¿—
  - [ ] `GET /api/ui-states` - è·å–æ‰€æœ‰ UI çŠ¶æ€
  - [ ] `GET /api/ui-state/{id}` - è·å– UI çŠ¶æ€
  - [ ] `PUT /api/ui-state/{id}` - æ›´æ–° UI çŠ¶æ€
  - [ ] `DELETE /api/ui-state/{id}` - åˆ é™¤ UI çŠ¶æ€

- [ ] å®ç°å¯åŠ¨é€»è¾‘
  - [ ] åˆå§‹åŒ– `DatabaseManager`
  - [ ] åŠ è½½æ‰€æœ‰ç›‘å¬å™¨ã€åŠ¨ä½œã€UI çŠ¶æ€æ¨¡æ¿
  - [ ] å¯åŠ¨æ–‡ä»¶ç›‘å¬å™¨ï¼ˆçƒ­é‡è½½ï¼‰

- [ ] å®ç° `main()` å…¥å£
  - [ ] ä½¿ç”¨ `uvicorn.run()` å¯åŠ¨æœåŠ¡å™¨
  - [ ] é…ç½®ç«¯å£ï¼ˆé»˜è®¤ 3000ï¼‰

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] å¯åŠ¨æœåŠ¡å™¨ï¼š`python server/server.py`
- [ ] è®¿é—® `http://localhost:3000/docs`ï¼ˆFastAPI è‡ªåŠ¨æ–‡æ¡£ï¼‰
- [ ] æµ‹è¯• WebSocket è¿æ¥ï¼ˆä½¿ç”¨ `wscat` å·¥å…·ï¼‰
- [ ] æµ‹è¯• REST API ç«¯ç‚¹ï¼ˆä½¿ç”¨ `curl` æˆ– Postmanï¼‰

---

### 5.2 ç«¯ç‚¹å¤„ç†å‡½æ•° (P2)
**æ–‡ä»¶**ï¼š`server/endpoints.py`

- [ ] å®ç° `handle_transactions_endpoint()`
  - [ ] è°ƒç”¨ `DatabaseManager.search_transactions()`
  - [ ] è¿”å› JSON å“åº”

- [ ] å®ç° `handle_search_endpoint()`
  - [ ] è§£æè¯·æ±‚ä½“ï¼ˆæœç´¢æ¡ä»¶ï¼‰
  - [ ] è°ƒç”¨ `DatabaseManager.search_transactions()`

- [ ] å®ç° `handle_transaction_details_endpoint()`
  - [ ] è°ƒç”¨ `DatabaseManager.get_transaction_by_id()`

- [ ] å®ç° `handle_listeners_endpoint()`
  - [ ] è°ƒç”¨ `ListenersManager.get_all_listeners()`

- [ ] å®ç° `handle_listener_logs_endpoint()`
  - [ ] è°ƒç”¨ `LogWriter.read_logs()`

- [ ] å®ç° UI çŠ¶æ€ç«¯ç‚¹å¤„ç†å‡½æ•°
  - [ ] `handle_get_ui_state()`
  - [ ] `handle_set_ui_state()`
  - [ ] `handle_list_ui_states()`

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] æµ‹è¯•æ¯ä¸ªç«¯ç‚¹çš„æ­£å¸¸å“åº”
- [ ] æµ‹è¯•é”™è¯¯å¤„ç†ï¼ˆ404, 500ï¼‰

---

### 5.3 ç¤ºä¾‹ç›‘å¬å™¨å’ŒåŠ¨ä½œ (P2)

**ç›‘å¬å™¨ç¤ºä¾‹**ï¼š`agent/custom_scripts/listeners/transaction_classifier.py`
- [ ] å‚è€ƒ `LISTENER_TEMPLATE.md` ç¼–å†™
- [ ] å®ç°äº¤æ˜“åˆ†ç±»é€»è¾‘ï¼ˆä½¿ç”¨ AIï¼‰
- [ ] æ›´æ–° UI çŠ¶æ€

**åŠ¨ä½œç¤ºä¾‹**ï¼š`agent/custom_scripts/actions/add_expense.py`
- [ ] å‚è€ƒ `ACTION_TEMPLATE.md` ç¼–å†™
- [ ] å®ç°æ·»åŠ è´¹ç”¨åŠŸèƒ½
- [ ] å‚æ•°éªŒè¯ï¼ˆJSON Schemaï¼‰

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] è§¦å‘ç›‘å¬å™¨ï¼ˆæ’å…¥æ–°äº¤æ˜“ï¼‰
- [ ] éªŒè¯ç›‘å¬å™¨æ—¥å¿—
- [ ] æ‰§è¡ŒåŠ¨ä½œï¼ˆé€šè¿‡ WebSocketï¼‰
- [ ] éªŒè¯åŠ¨ä½œç»“æœ

---

## Phase 6: å¢å¼ºåŠŸèƒ½ï¼ˆP2ï¼‰

### 6.1 æ—¥å¿—ç³»ç»Ÿ (P2)
**æ–‡ä»¶**ï¼š`ccsdk/log_writer.py`

- [ ] å®šä¹‰ `LogWriter` ç±»
  - [ ] å†™å…¥ JSONL æ ¼å¼æ—¥å¿—
  - [ ] æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶ï¼ˆ`YYYY-MM-DD.jsonl`ï¼‰

- [ ] å®ç° `append_log()` æ–¹æ³•
  - [ ] å¼‚æ­¥å†™å…¥æ—¥å¿—

- [ ] å®ç° `read_logs()` æ–¹æ³•
  - [ ] è¯»å–æŒ‡å®šç›‘å¬å™¨çš„æ—¥å¿—
  - [ ] æ”¯æŒåˆ†é¡µï¼ˆ`limit`ï¼‰

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] æµ‹è¯•æ—¥å¿—å†™å…¥
- [ ] æµ‹è¯•æ—¥å¿—è¯»å–

---

### 6.2 çƒ­é‡è½½ç³»ç»Ÿ (P2)
**æ–‡ä»¶**ï¼š`ccsdk/file_watcher.py`

- [ ] ä½¿ç”¨ `watchdog` åº“å®ç°æ–‡ä»¶ç›‘å¬
- [ ] å®šä¹‰ `ChangeHandler(FileSystemEventHandler)`
  - [ ] é‡å†™ `on_modified()` æ–¹æ³•
  - [ ] è§¦å‘é‡æ–°åŠ è½½å›è°ƒ

- [ ] é›†æˆåˆ° `ListenersManager` å’Œ `ActionsManager`

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] ä¿®æ”¹ç›‘å¬å™¨æ–‡ä»¶ï¼ŒéªŒè¯è‡ªåŠ¨é‡æ–°åŠ è½½
- [ ] éªŒè¯å‰ç«¯æ”¶åˆ°æ›´æ–°é€šçŸ¥

---

### 6.3 å…¨æ–‡æœç´¢ï¼ˆå¯é€‰ï¼‰(P2)
**æ–‡ä»¶**ï¼š`database/fts_manager.py`

- [ ] åˆ›å»º FTS5 è™šæ‹Ÿè¡¨
  - [ ] ç´¢å¼•äº¤æ˜“æè¿°ã€å•†å®¶åç§°

- [ ] å®ç° `search_transactions_fts()` æ–¹æ³•
  - [ ] ä½¿ç”¨ FTS5 MATCH è¯­æ³•

- [ ] åˆ›å»ºè§¦å‘å™¨è‡ªåŠ¨æ›´æ–° FTS ç´¢å¼•

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] æµ‹è¯•å…¨æ–‡æœç´¢æ€§èƒ½ï¼ˆvs æ™®é€š LIKE æŸ¥è¯¢ï¼‰

---

## Phase 7: æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆP3ï¼‰

### 7.1 å•å…ƒæµ‹è¯• (P3)
**ç›®å½•**ï¼š`tests/`

- [ ] `test_session.py`
  - [ ] æµ‹è¯•å¹¶å‘æ§åˆ¶
  - [ ] æµ‹è¯•å¤šè½®å¯¹è¯
  - [ ] æµ‹è¯•è®¢é˜…è€…ç®¡ç†

- [ ] `test_database.py`
  - [ ] æµ‹è¯•äº¤æ˜“ CRUD
  - [ ] æµ‹è¯•æœç´¢åŠŸèƒ½
  - [ ] æµ‹è¯• UI çŠ¶æ€ç®¡ç†

- [ ] `test_listeners.py`
  - [ ] æµ‹è¯•ç›‘å¬å™¨åŠ è½½
  - [ ] æµ‹è¯•äº‹ä»¶åŒ¹é…
  - [ ] æµ‹è¯•ä¸Šä¸‹æ–‡æ³¨å…¥

- [ ] `test_actions.py`
  - [ ] æµ‹è¯•åŠ¨ä½œåŠ è½½
  - [ ] æµ‹è¯•åŠ¨ä½œæ‰§è¡Œ
  - [ ] æµ‹è¯•å‚æ•°éªŒè¯

**æ‰§è¡Œ**ï¼š
- [ ] è¿è¡Œ `pytest tests/`
- [ ] ä»£ç è¦†ç›–ç‡ > 80%

---

### 7.2 é›†æˆæµ‹è¯• (P3)
**æ–‡ä»¶**ï¼š`tests/test_integration.py`

- [ ] æµ‹è¯•å®Œæ•´ä¼šè¯æµç¨‹
  - [ ] åˆ›å»ºä¼šè¯
  - [ ] å‘é€ç”¨æˆ·æ¶ˆæ¯
  - [ ] æ¥æ”¶ AI å“åº”
  - [ ] æ‰§è¡ŒåŠ¨ä½œ
  - [ ] è§¦å‘ç›‘å¬å™¨

- [ ] æµ‹è¯•å¤šå®¢æˆ·ç«¯åœºæ™¯
  - [ ] å¤šä¸ªå®¢æˆ·ç«¯è®¢é˜…åŒä¸€ä¼šè¯
  - [ ] å¹¿æ’­æ¶ˆæ¯åˆ°æ‰€æœ‰å®¢æˆ·ç«¯

**æ‰§è¡Œ**ï¼š
- [ ] å¯åŠ¨æœåŠ¡å™¨
- [ ] è¿è¡Œé›†æˆæµ‹è¯•

---

### 7.3 æ€§èƒ½ä¼˜åŒ– (P3)

- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
  - [ ] ä½¿ç”¨ç´¢å¼•
  - [ ] é¿å… N+1 æŸ¥è¯¢
  - [ ] ä½¿ç”¨è¿æ¥æ± 

- [ ] å¼‚æ­¥ä¼˜åŒ–
  - [ ] ä½¿ç”¨ `asyncio.gather()` å¹¶è¡Œæ‰§è¡Œ
  - [ ] é¿å…é˜»å¡æ“ä½œ

- [ ] å†…å­˜ä¼˜åŒ–
  - [ ] å®šæœŸæ¸…ç†è¿‡æœŸä¼šè¯
  - [ ] é™åˆ¶è®¢é˜…è€…æ•°é‡

**æ€§èƒ½åŸºå‡†**ï¼š
- [ ] å¹¶å‘è¿æ¥æ•° > 100
- [ ] æ¶ˆæ¯å¤„ç†å»¶è¿Ÿ < 100ms
- [ ] æ•°æ®åº“æŸ¥è¯¢ < 50ms

---

### 7.4 é”™è¯¯å¤„ç†å’Œæ—¥å¿— (P3)

- [ ] ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
  - [ ] `{ "error": "message", "code": 400 }`

- [ ] æ—¥å¿—çº§åˆ«é…ç½®
  - [ ] `DEBUG`, `INFO`, `WARNING`, `ERROR`

- [ ] å¼‚å¸¸æ•è·
  - [ ] å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ˆFastAPI `@app.exception_handler`ï¼‰

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] æµ‹è¯•å„ç§å¼‚å¸¸åœºæ™¯
- [ ] éªŒè¯æ—¥å¿—è¾“å‡º

---

## Phase 8: éƒ¨ç½²å‡†å¤‡ï¼ˆP3ï¼‰

### 8.1 ç¯å¢ƒé…ç½® (P3)

- [ ] åˆ›å»º `config.py` ç»Ÿä¸€é…ç½®ç®¡ç†
  - [ ] ä»ç¯å¢ƒå˜é‡è¯»å–é…ç½®
  - [ ] æä¾›é»˜è®¤å€¼

- [ ] åˆ›å»º `.env.example` æ¨¡æ¿æ–‡ä»¶

- [ ] æ–‡æ¡£åŒ–ç¯å¢ƒå˜é‡è¯´æ˜

---

### 8.2 å®¹å™¨åŒ–ï¼ˆå¯é€‰ï¼‰(P3)

- [ ] åˆ›å»º `Dockerfile`
  - [ ] åŸºäº `python:3.11-slim`
  - [ ] å®‰è£…ä¾èµ–
  - [ ] å¤åˆ¶ä»£ç 
  - [ ] æš´éœ²ç«¯å£ 3000

- [ ] åˆ›å»º `docker-compose.yml`
  - [ ] å®šä¹‰æœåŠ¡ï¼ˆbackend, frontendï¼‰
  - [ ] æŒ‚è½½æ•°æ®å·ï¼ˆæ•°æ®åº“æ–‡ä»¶ï¼‰

**æµ‹è¯•æ£€æŸ¥ç‚¹**ï¼š
- [ ] æ„å»ºé•œåƒï¼š`docker build -t finance-agent .`
- [ ] è¿è¡Œå®¹å™¨ï¼š`docker run -p 3000:3000 finance-agent`

---

### 8.3 æ–‡æ¡£å®Œå–„ (P3)

- [ ] æ›´æ–° `README.md`
  - [ ] å®‰è£…è¯´æ˜
  - [ ] å¯åŠ¨å‘½ä»¤
  - [ ] API æ–‡æ¡£é“¾æ¥
  - [ ] å¼€å‘æŒ‡å—

- [ ] åˆ›å»º `CONTRIBUTING.md`
  - [ ] è´¡çŒ®æµç¨‹
  - [ ] ä»£ç è§„èŒƒ

- [ ] åˆ›å»º `API.md`
  - [ ] æ‰€æœ‰ç«¯ç‚¹è¯´æ˜
  - [ ] è¯·æ±‚/å“åº”ç¤ºä¾‹

---

## è¿›åº¦è¿½è¸ª

### å®Œæˆåº¦ç»Ÿè®¡
- [ ] Phase 1: é¡¹ç›®åˆå§‹åŒ– (0/2)
- [ ] Phase 2: æ ¸å¿ƒæ¶æ„ (0/3)
- [ ] Phase 3: æ’ä»¶ç³»ç»Ÿ (0/3)
- [ ] Phase 4: æ•°æ®åº“å±‚ (0/3)
- [ ] Phase 5: ä¸šåŠ¡åŠŸèƒ½ (0/3)
- [ ] Phase 6: å¢å¼ºåŠŸèƒ½ (0/3)
- [ ] Phase 7: æµ‹è¯•ä¸ä¼˜åŒ– (0/4)
- [ ] Phase 8: éƒ¨ç½²å‡†å¤‡ (0/3)

### æ€»ä½“è¿›åº¦ï¼š0% (0/24)

---

## é‡Œç¨‹ç¢‘

### Milestone 1: MVP å¯è¿è¡Œ (Week 2)
- [ ] å®Œæˆ Phase 1ï¼ˆé¡¹ç›®åˆå§‹åŒ–ï¼‰
- [ ] å®Œæˆ Phase 2.0ï¼ˆæ•°æ®åº“è®¾è®¡è¯„å®¡ï¼‰âœ… **å…³é”®å‰ç½®ä»»åŠ¡**
- [ ] å®Œæˆ Phase 2.1-2.3ï¼ˆSession å’Œ WebSocketï¼‰
- [ ] Session å’Œ WebSocket åŸºæœ¬å¯ç”¨
- [ ] å¯ä»¥åˆ›å»ºä¼šè¯å¹¶å‘é€æ¶ˆæ¯

### Milestone 2: æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ (Week 4)
- [ ] å®Œæˆ Phase 3-4
- [ ] ç›‘å¬å™¨å’ŒåŠ¨ä½œç³»ç»Ÿå¯ç”¨
- [ ] æ•°æ®åº“æ“ä½œå®Œæ•´

### Milestone 3: ç”Ÿäº§å°±ç»ª (Week 6)
- [ ] å®Œæˆ Phase 5-7
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ€§èƒ½æ»¡è¶³åŸºå‡†

### Milestone 4: éƒ¨ç½²ä¸Šçº¿ (Week 7+)
- [ ] å®Œæˆ Phase 8
- [ ] æ–‡æ¡£å®Œå–„
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

## ç»´æŠ¤å»ºè®®

1. **æ¯æ—¥æ£€æŸ¥**ï¼šå®Œæˆä¸€ä¸ªä»»åŠ¡å‹¾é€‰ä¸€ä¸ªï¼Œä¿æŒè¿›åº¦å¯è§
2. **æ¯å‘¨å›é¡¾**ï¼šæ£€æŸ¥æ˜¯å¦åç¦»è®¡åˆ’ï¼Œè°ƒæ•´ä¼˜å…ˆçº§
3. **é—®é¢˜è®°å½•**ï¼šé‡åˆ°æŠ€æœ¯éš¾ç‚¹è®°å½•åˆ° `ISSUES.md`
4. **å®šæœŸæ›´æ–°**ï¼šæ ¹æ®å®é™…å¼€å‘æƒ…å†µæ›´æ–°æ¸…å•

---

## é™„å½•ï¼šå…³é”®ä¾èµ–å…³ç³»

```mermaid
graph TB
    A[Session] --> B[AIClient]
    A --> C[DatabaseManager]
    D[WebSocketHandler] --> A
    E[ListenersManager] --> C
    E --> F[UIStateManager]
    F --> C
    G[ActionsManager] --> C
    G --> F
    H[Server] --> D
    H --> E
    H --> G
```

**å®ç°é¡ºåºå»ºè®®**ï¼š
1. DatabaseManager â†’ Session â†’ WebSocketHandler
2. ListenersManager â†’ ActionsManager â†’ UIStateManager
3. Server â†’ Endpoints â†’ ç¤ºä¾‹è„šæœ¬

---

**æœ€åæ›´æ–°**ï¼šåˆå§‹ç‰ˆæœ¬  
**ä¸‹æ¬¡å®¡æŸ¥**ï¼šå®Œæˆ Phase 1 å
